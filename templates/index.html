{% extends "layout.html" %}

{% block content %}
<h2 class="mb-4">Portfolio Dashboard</h2>
<div class="row mb-4">
  <div class="col-md-6">
    <form class="row row-cols-lg-auto g-3 align-items-center" method="POST" action="{{ url_for('create_portfolio') }}">
      <div class="col-12">
        <label class="visually-hidden" for="portfolioName">Portfolio Name</label>
        <input type="text" class="form-control" id="portfolioName" name="name" placeholder="New Portfolio Name" required />
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-success">Create Portfolio</button>
      </div>
    </form>
  </div>
</div>

{% if portfolios %}
<!-- Display portfolio summaries as cards instead of a plain table -->
<div class="row g-3">
  {% for p in portfolios %}
  <div class="col-md-6 col-lg-4">
    <div class="card h-100 border-{{ 'success' if p.total_profit >= 0 else 'danger' }}">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ p.name }}</h5>
        <p class="card-text mb-1"><strong>Cash:</strong> A${{ '%.2f' % p.cash_balance }}</p>
        <p class="card-text mb-1"><strong>Portfolio Value:</strong> A${{ '%.2f' % p.positions_value }}</p>
        <p class="card-text mb-1"><strong>Total Net Worth:</strong> A${{ '%.2f' % p.net_worth }}</p>
        <p class="card-text mb-1">
          <strong>Daily P/L:</strong>
          <span class="{{ 'text-success' if p.daily_profit >= 0 else 'text-danger' }}">
            A${{ '%.2f' % p.daily_profit }}
          </span>
        </p>
        <p class="card-text mb-3">
          <strong>Total P/L:</strong>
          <span class="{{ 'text-success' if p.total_profit >= 0 else 'text-danger' }}">
            A${{ '%.2f' % p.total_profit }}
          </span>
        </p>
        <div class="mt-auto">
          <a href="{{ url_for('view_portfolio', portfolio_id=p.id) }}" class="btn btn-primary btn-sm me-2">View</a>
          <form class="d-inline" method="POST" action="{{ url_for('delete_portfolio', portfolio_id=p.id) }}" onsubmit="return confirm('Are you sure you want to delete this portfolio?');">
            <!-- Make the delete button appear as a subtle link rather than a prominent red button -->
            <button type="submit" class="btn btn-link text-danger p-0 small" style="text-decoration: none;">Delete</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<p>No portfolios found. Use the form above to create one.</p>
{% endif %}
{% endblock %}